/*
  backbone-http.js 0.6.0
  Copyright (c) 2013-2014 Vidigami
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/vidigami/backbone-http
  Dependencies: Backbone.js, Underscore.js, and Moment.js.
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("backbone-orm"),require("superagent"),require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["backbone-orm","superagent","underscore","backbone"],t):"object"==typeof exports?exports.BackboneHTTP=t(require("backbone-orm"),require("superagent"),require("underscore"),require("backbone")):e.BackboneHTTP=t(e.BackboneORM,e.superagent,e._,e.Backbone)}(this,function(e,t,r,o){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var o,n,s,i,u;for(e.exports={sync:r(3),modules:{"backbone-orm":o=r(1),superagent:r(2)},_:o._,Backbone:o.Backbone},u=["url","querystring","lru-cache","underscore","backbone","moment","inflection","stream"],s=0,i=u.length;i>s;s++)n=u[s],e.exports.modules[n]=o.modules[n]},function(t){t.exports=e},function(e){e.exports=t},function(e,t,r){var o,n,s,i,u,a,c,l,p;p=r(4),o=r(5),l=r(1),a=l.Schema,c=l.Utils,i=l.JSONUtils,u=l.CacheSingletons.ModelCache,n=r(6),s=function(){function e(e,t){if(this.model_type=e,null==t&&(t={}),!t.beforeSend||(this._beforeSend=t.beforeSend),this.model_type.model_name=c.findOrGenerateModelName(this.model_type),!(this.url=p.result(new this.model_type,"url")))throw new Error("Missing url for model: "+this.model_type);this.schema=new a(this.model_type),this.request=r(2)}return e.prototype.initialize=function(){return this.is_initialized?void 0:(this.is_initialized=!0,this.schema.initialize())},e.prototype.resetSchema=function(e,t){var r;return r=this.request.del(this.url),this.beforeSend(r,null,e),r.end(function(e,r){return e?t(e):r.ok?t():t(new Error("Ajax failed with status "+r.status+" for destroy with: "+i.stringify(r.body)))})},e.prototype.cursor=function(e){return null==e&&(e={}),new n(e,{model_type:this.model_type,url:this.url,request:this.request,sync:this})},e.prototype.destroy=function(e,t){var r;return r=this.request.del(this.url).query(e),this.beforeSend(r,null),r.end(function(e,r){return e?t(e):r.ok?t():t(new Error("Ajax failed with status "+r.status+" for destroy with: "+i.stringify(r.body)))})},e.prototype.beforeSend=function(e,t,r){return null==r&&(r={}),!r.beforeSend||r.beforeSend(e,t,r,this),!this._beforeSend||this._beforeSend(e,t,r,this)},e}(),e.exports=function(t,r){var o,n,a;return c.isCollection(new t)?(o=c.configureCollectionModelType(t,e.exports,r),t.prototype.sync=o.prototype.sync):(n=new s(t,r),t.prototype.sync=a=function(t,r,o){var s,u,a;if(null==o&&(o={}),n.initialize(),"createSync"===t)return e.exports.apply(null,Array.prototype.slice.call(arguments,1));if("sync"===t)return n;if("schema"===t)return n.schema;if("isRemote"===t)return!0;if(p.contains(["create","update","patch","delete","read"],t)){if(!(a=o.url||p.result(r,"url")))throw new Error("Missing url for model");switch(u=n.request,t){case"read":s=u.get(a).query({$one:!r.models}).type("json");break;case"create":s=u.post(a).send(o.attrs||r.toJSON(o)).type("json");break;case"update":s=u.put(a).send(o.attrs||r.toJSON(o)).type("json");break;case"patch":s=u.patch(a).send(o.attrs||r.toJSON(o)).type("json");break;case"delete":s=u.del(a)}return n.beforeSend(s,r,o),void s.end(function(e,r){return e?o.error(e):r.ok?o.success(i.parse(r.body)):o.error(new Error("Ajax failed with status "+r.status+" for "+t+" with: "+i.stringify(r.body)))})}return n[t]?n[t].apply(n,Array.prototype.slice.call(arguments,1)):void 0},c.configureModelType(t),u.configureSync(t,a))}},function(e){e.exports=r},function(e){e.exports=o},function(e,t,r){var o,n,s,i,u,a={}.hasOwnProperty,c=function(e,t){function r(){this.constructor=e}for(var o in t)a.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};u=r(4),o=r(1).Cursor,s=r(1).JSONUtils,i=r(1).Utils,e.exports=n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.toJSON=function(e){var t,r;return this.hasCursorQuery("$zero")?e(null,this.hasCursorQuery("$one")?null:[]):(r=this.request.get(this.url).query(t=s.toQuery(u.extend(u.clone(this._find),this._cursor))).type("json"),this.sync.beforeSend(r,null),r.end(function(r){return function(o,n){var i;return o?e(o):t.$one&&404===n.status?e(null,null):n.ok?(i=s.parse(n.body),e(null,r.hasCursorQuery("$count")||r.hasCursorQuery("$exists")?i.result:i)):e(new Error("Ajax failed with status "+n.status+" with: "+s.stringify(n.body)))}}(this)))},t}(o)}])});