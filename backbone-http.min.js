/*
  backbone-http.js 0.6.0
  Copyright (c) 2013-2014 Vidigami
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/vidigami/backbone-http
  Dependencies: Backbone.js, Underscore.js, and Moment.js.
*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("backbone-orm"),require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["backbone-orm","underscore","backbone"],e):"object"==typeof exports?exports.BackboneHTTP=e(require("backbone-orm"),require("underscore"),require("backbone")):t.BackboneHTTP=e(t.BackboneORM,t._,t.Backbone)}(this,function(t,e,r){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n,o,s,i,a;for(n=r(1),t.exports={sync:r(2),_:n._,Backbone:n.Backbone,modules:{"backbone-orm":n}},a=["url","querystring","lru-cache","underscore","backbone","moment","inflection","stream"],s=0,i=a.length;i>s;s++)o=a[s],t.exports.modules[o]=n.modules[o]},function(e){e.exports=t},function(t,e,r){var n,o,s,i,a,h,u,c,l,p,f;f=r(3),n=r(4),l=n.sync,p=r(1),h=p.Schema,c=p.Utils,i=p.JSONUtils,a=p.CacheSingletons.ModelCache,o=r(5),u=r(6),s=function(){function t(t,e){if(this.model_type=t,null==e&&(e={}),!e.beforeSend||(this._beforeSend=e.beforeSend),this.model_type.model_name=c.findOrGenerateModelName(this.model_type),!(this.url=f.result(new this.model_type,"url")))throw new Error("Missing url for model: "+this.model_type);this.schema=new h(this.model_type),this.event_emitter=f.extend({},n.Events)}return t.prototype.initialize=function(){return this.is_initialized?void 0:(this.is_initialized=!0,this.schema.initialize())},t.prototype.resetSchema=function(t,e){return this.http("delete",null,{},e)},t.prototype.cursor=function(t){return null==t&&(t={}),new o(t,{model_type:this.model_type,sync:this})},t.prototype.destroy=function(t,e){var r;return 1===arguments.length&&(r=[{},t],t=r[0],e=r[1]),this.http("delete",null,{query:t},e)},t.prototype.http=function(t,e,r,n){var o,s;return o=e?f.result(e,"url"):this.url,r.query&&f.size(r.query)&&(s=u.parse(o,!0),f.extend(s.query,i.toQuery(r.query)),o=u.format(s)),l(t,e||this.event_emitter,f.extend({url:o,beforeSend:this.beforeSend},r,{success:function(t){return n(null,i.parse(t))},error:function(e){return n(f.extend(new Error("Ajax failed with status "+e.status+" for "+t),{status:e.status}))}}))},t}(),t.exports=function(e,r){var n,o,i;return c.isCollection(new e)?(n=c.configureCollectionModelType(e,t.exports,r),e.prototype.sync=n.prototype.sync):(o=new s(e,r),e.prototype.sync=i=function(e,r,n){var s;if(null==n&&(n={}),o.initialize(),"createSync"===e)return t.exports.apply(null,Array.prototype.slice.call(arguments,1));if("sync"===e)return o;if("schema"===e)return o.schema;if("isRemote"===e)return!0;if(f.contains(["create","update","patch","delete","read"],e)){if(!(s=n.url||f.result(r,"url")))throw new Error("Missing url for model");return"read"===e&&(n=f.extend({$one:!r.models},n)),void o.http(e,r,f.omit(n,"error","success"),function(){return function(t,e){return t?n.error(t):n.success(e)}}(this))}return o[e]?o[e].apply(o,Array.prototype.slice.call(arguments,1)):void 0},c.configureModelType(e),a.configureSync(e,i))}},function(t){t.exports=e},function(t){t.exports=r},function(t,e,r){var n,o,s,i,a,h={}.hasOwnProperty,u=function(t,e){function r(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};a=r(3),n=r(1).Cursor,s=r(1).JSONUtils,i=r(1).Utils,t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.toJSON=function(t){var e;return this.hasCursorQuery("$zero")?t(null,this.hasCursorQuery("$one")?null:[]):this.sync.http("read",null,{query:e=a.extend(a.clone(this._find),this._cursor)},function(r){return function(n,o){return e.$one&&n&&404===n.status?t(null,null):t(null,r.hasCursorQuery("$count")||r.hasCursorQuery("$exists")?o.result:o)}}(this))},e}(n)},function(t,e,r){function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(t,e,r){if(t&&u.isObject(t)&&t instanceof n)return t;var o=new n;return o.parse(t,e,r),o}function s(t){return u.isString(t)&&(t=o(t)),t instanceof n?t.format():n.prototype.format.call(t)}function i(t,e){return o(t,!1,!0).resolve(e)}function a(t,e){return t?o(t,!1,!0).resolveObject(e):e}var h={encode:function(t){return t}},u=r(7),c=r(8);e.parse=o,e.resolve=i,e.resolveObject=a,e.format=s,e.Url=n;var l=/^([a-z0-9.+-]+:)/i,p=/:[0-9]*$/,f=["<",">",'"',"`"," ","\r","\n","	"],m=["{","}","|","\\","^","`"].concat(f),y=["'"].concat(m),d=["%","/","?",";","#"].concat(y),v=["/","?","#"],b=255,g=/^[a-z0-9A-Z_-]{0,63}$/,O=/^([a-z0-9A-Z_-]{0,63})(.*)$/,j={javascript:!0,"javascript:":!0},x={javascript:!0,"javascript:":!0},w={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=r(9);n.prototype.parse=function(t,e,r){if(!u.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t;n=c.trim(n);var o=l.exec(n);if(o){o=o[0];var s=o.toLowerCase();this.protocol=s,n=n.substr(o.length)}if(r||o||n.match(/^\/\/[^@\/]+@[^@\/]+/)){var i="//"===n.substr(0,2);!i||o&&x[o]||(n=n.substr(2),this.slashes=!0)}if(!x[o]&&(i||o&&!w[o])){for(var a=-1,p=0;p<v.length;p++){var f=n.indexOf(v[p]);-1!==f&&(-1===a||a>f)&&(a=f)}var m,q;q=-1===a?n.lastIndexOf("@"):n.lastIndexOf("@",a),-1!==q&&(m=n.slice(0,q),n=n.slice(q+1),this.auth=decodeURIComponent(m)),a=-1;for(var p=0;p<d.length;p++){var f=n.indexOf(d[p]);-1!==f&&(-1===a||a>f)&&(a=f)}-1===a&&(a=n.length),this.host=n.slice(0,a),n=n.slice(a),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var k=this.hostname.split(/\./),p=0,P=k.length;P>p;p++){var C=k[p];if(C&&!C.match(g)){for(var N="",S=0,E=C.length;E>S;S++)N+=C.charCodeAt(S)>127?"x":C[S];if(!N.match(g)){var U=k.slice(0,p),z=k.slice(p+1),I=C.match(O);I&&(U.push(I[1]),z.unshift(I[2])),z.length&&(n="/"+z.join(".")+n),this.hostname=U.join(".");break}}}if(this.hostname=this.hostname.length>b?"":this.hostname.toLowerCase(),!A){for(var R=this.hostname.split("."),T=[],p=0;p<R.length;++p){var $=R[p];T.push($.match(/[^A-Za-z0-9_-]/)?"xn--"+h.encode($):$)}this.hostname=T.join(".")}var B=this.port?":"+this.port:"",D=this.hostname||"";this.host=D+B,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==n[0]&&(n="/"+n))}if(!j[s])for(var p=0,P=y.length;P>p;p++){var M=y[p],Q=encodeURIComponent(M);Q===M&&(Q=escape(M)),n=n.split(M).join(Q)}var H=n.indexOf("#");-1!==H&&(this.hash=n.substr(H),n=n.slice(0,H));var J=n.indexOf("?");if(-1!==J?(this.search=n.substr(J),this.query=n.substr(J+1),e&&(this.query=_.parse(this.query)),n=n.slice(0,J)):e&&(this.search="",this.query={}),n&&(this.pathname=n),w[s]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",$=this.search||"";this.path=B+$}return this.href=this.format(),this},n.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&u.isObject(this.query)&&c.keys(this.query).length&&(s=_.stringify(this.query));var i=this.search||s&&"?"+s||"";return e&&":"!==c.substr(e,-1)&&(e+=":"),this.slashes||(!e||w[e])&&o!==!1?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),i&&"?"!==i.charAt(0)&&(i="?"+i),r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),i=i.replace("#","%23"),e+o+r+i+n},n.prototype.resolve=function(t){return this.resolveObject(o(t,!1,!0)).format()},n.prototype.resolveObject=function(t){if(u.isString(t)){var e=new n;e.parse(t,!1,!0),t=e}var r=new n;if(c.forEach(c.keys(this),function(t){r[t]=this[t]},this),r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol)return c.forEach(c.keys(t),function(e){"protocol"!==e&&(r[e]=t[e])}),w[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r;if(t.protocol&&t.protocol!==r.protocol){if(!w[t.protocol])return c.forEach(c.keys(t),function(e){r[e]=t[e]}),r.href=r.format(),r;if(r.protocol=t.protocol,t.host||x[t.protocol])r.pathname=t.pathname;else{for(var o=(t.pathname||"").split("/");o.length&&!(t.host=o.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==o[0]&&o.unshift(""),o.length<2&&o.unshift(""),r.pathname=o.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var s=r.pathname||"",i=r.search||"";r.path=s+i}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var a=r.pathname&&"/"===r.pathname.charAt(0),h=t.host||t.pathname&&"/"===t.pathname.charAt(0),l=h||a||r.host&&t.pathname,p=l,f=r.pathname&&r.pathname.split("/")||[],o=t.pathname&&t.pathname.split("/")||[],m=r.protocol&&!w[r.protocol];if(m&&(r.hostname="",r.port=null,r.host&&(""===f[0]?f[0]=r.host:f.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===o[0]?o[0]=t.host:o.unshift(t.host)),t.host=null),l=l&&(""===o[0]||""===f[0])),h)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,f=o;else if(o.length)f||(f=[]),f.pop(),f=f.concat(o),r.search=t.search,r.query=t.query;else if(!u.isNullOrUndefined(t.search)){if(m){r.hostname=r.host=f.shift();var y=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;y&&(r.auth=y.shift(),r.host=r.hostname=y.shift())}return r.search=t.search,r.query=t.query,u.isNull(r.pathname)&&u.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!f.length)return r.pathname=null,r.path=r.search?"/"+r.search:null,r.href=r.format(),r;for(var d=f.slice(-1)[0],v=(r.host||t.host)&&("."===d||".."===d)||""===d,b=0,g=f.length;g>=0;g--)d=f[g],"."==d?f.splice(g,1):".."===d?(f.splice(g,1),b++):b&&(f.splice(g,1),b--);if(!l&&!p)for(;b--;b)f.unshift("..");!l||""===f[0]||f[0]&&"/"===f[0].charAt(0)||f.unshift(""),v&&"/"!==c.substr(f.join("/"),-1)&&f.push("");var O=""===f[0]||f[0]&&"/"===f[0].charAt(0);if(m){r.hostname=r.host=O?"":f.length?f.shift():"";var y=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;y&&(r.auth=y.shift(),r.host=r.hostname=y.shift())}return l=l||r.host&&f.length,l&&!O&&f.unshift(""),f.length?r.pathname=f.join("/"):(r.pathname=null,r.path=null),u.isNull(r.pathname)&&u.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},n.prototype.parseHost=function(){var t=this.host,e=p.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,r){function n(t){return c.isArray(t)}function o(t){return"boolean"==typeof t}function s(t){return null===t}function i(t){return null==t}function a(t){return"number"==typeof t}function h(t){return"string"==typeof t}function u(t){return"object"==typeof t&&t}var c=r(8);e.isArray=n,e.isBoolean=o,e.isNull=s,e.isNullOrUndefined=i,e.isNumber=a,e.isString=h,e.isObject=u},function(t,e){function r(t){return"[object Array]"===h.call(t)}function n(t,e){var r;if(null===t)r={__proto__:null};else{if("object"!=typeof t)throw new TypeError("typeof prototype["+typeof t+"] != 'object'");var n=function(){};n.prototype=t,r=new n,r.__proto__=t}return"undefined"!=typeof e&&Object.defineProperties&&Object.defineProperties(r,e),r}function o(t){return"object"!=typeof t&&"function"!=typeof t||null===t}function s(t){if(o(t))throw new TypeError("Object.keys called on a non-object");var e=[];for(var r in t)u.call(t,r)&&e.push(r);return e}function i(t){if(o(t))throw new TypeError("Object.getOwnPropertyNames called on a non-object");var r=s(t);return e.isArray(t)&&-1===e.indexOf(t,"length")&&r.push("length"),r}function a(t,e){return{value:t[e]}}var h=Object.prototype.toString,u=Object.prototype.hasOwnProperty;e.isArray="function"==typeof Array.isArray?Array.isArray:r,e.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0;r<t.length;r++)if(e===t[r])return r;return-1},e.filter=function(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r},e.forEach=function(t,e,r){if(t.forEach)return t.forEach(e,r);for(var n=0;n<t.length;n++)e.call(r,t[n],n,t)},e.map=function(t,e){if(t.map)return t.map(e);for(var r=new Array(t.length),n=0;n<t.length;n++)r[n]=e(t[n],n,t);return r},e.reduce=function(t,e,r){if(t.reduce)return t.reduce(e,r);var n,o=!1;2<arguments.length&&(n=r,o=!0);for(var s=0,i=t.length;i>s;++s)t.hasOwnProperty(s)&&(o?n=e(n,t[s],s,t):(n=t[s],o=!0));return n},e.substr="b"!=="ab".substr(-1)?function(t,e,r){return 0>e&&(e=t.length+e),t.substr(e,r)}:function(t,e,r){return t.substr(e,r)},e.trim=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},e.bind=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();if(e.bind)return e.bind.apply(e,t);var r=t.shift();return function(){e.apply(r,t.concat([Array.prototype.slice.call(arguments)]))}},e.create="function"==typeof Object.create?Object.create:n;var c="function"==typeof Object.keys?Object.keys:s,l="function"==typeof Object.getOwnPropertyNames?Object.getOwnPropertyNames:i;if((new Error).hasOwnProperty("description")){var p=function(t,r){return"[object Error]"===h.call(t)&&(r=e.filter(r,function(t){return"description"!==t&&"number"!==t&&"message"!==t})),r};e.keys=function(t){return p(t,c(t))},e.getOwnPropertyNames=function(t){return p(t,l(t))}}else e.keys=c,e.getOwnPropertyNames=l;if("function"==typeof Object.getOwnPropertyDescriptor)try{Object.getOwnPropertyDescriptor({a:1},"a"),e.getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor}catch(f){e.getOwnPropertyDescriptor=function(t,e){try{return Object.getOwnPropertyDescriptor(t,e)}catch(r){return a(t,e)}}}else e.getOwnPropertyDescriptor=a},function(t,e,r){function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var o=e,s=r(7),i=r(8);o.unescape=function(t){return decodeURIComponent(t)},o.escape=function(t){return encodeURIComponent(t)};var a=function(t){return s.isString(t)?t:s.isBoolean(t)?t?"true":"false":s.isNumber(t)&&isFinite(t)?t:""};o.stringify=o.encode=function(t,e,r,n){return e=e||"&",r=r||"=",s.isNull(t)&&(t=void 0),s.isObject(t)?i.map(i.keys(t),function(n){var h=o.escape(a(n))+r;return s.isArray(t[n])?i.map(t[n],function(t){return h+o.escape(a(t))}).join(e):h+o.escape(a(t[n]))}).join(e):n?o.escape(a(n))+r+o.escape(a(t)):""},o.parse=o.decode=function(t,e,r,i){e=e||"&",r=r||"=";var a={};if(!s.isString(t)||0===t.length)return a;var h=/\+/g;t=t.split(e);var u=1e3;i&&s.isNumber(i.maxKeys)&&(u=i.maxKeys);var c=t.length;u>0&&c>u&&(c=u);for(var l=0;c>l;++l){var p,f,m,y,d=t[l].replace(h,"%20"),v=d.indexOf(r);v>=0?(p=d.substr(0,v),f=d.substr(v+1)):(p=d,f="");try{m=decodeURIComponent(p),y=decodeURIComponent(f)}catch(b){m=o.unescape(p,!0),y=o.unescape(f,!0)}n(a,m)?s.isArray(a[m])?a[m].push(y):a[m]=[a[m],y]:a[m]=y}return a}}])});