/*
  backbone-http.js 0.6.0
  Copyright (c) 2013-2014 Vidigami
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/vidigami/backbone-http
  Dependencies: Backbone.js, Underscore.js, and Moment.js.
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("backbone-orm")):"function"==typeof define&&define.amd?define(["backbone-orm"],t):"object"==typeof exports?exports.BackboneHTTP=t(require("backbone-orm")):e.BackboneHTTP=t(e.BackboneORM)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,o,u,i,s,c;o=r(1),e.exports=n=r(2),i={sync:r(3),_:o._,Backbone:o.Backbone},i._.extend(n,i),n.modules={"backbone-orm":o},c=o.modules;for(u in c)s=c[u],n.modules[u]=s},function(t){t.exports=e},function(e){e.exports={}},function(e,t,r){var n,o,u,i,s,c,l,p,a,f;f=r(1),a=f._,n=f.Backbone,p=f.Utils,s=f.JSONUtils,c=f.Schema,l=r(1).modules.url,u=r(4),o={embed:!0,json:!0,self_reference:!0},i=function(){function e(e,t){if(this.model_type=e,null==t&&(t={}),this.model_type.model_name=p.findOrGenerateModelName(this.model_type),!(this.url=a.result(new this.model_type,"url")))throw new Error("Missing url for model: "+this.model_type);this.schema=new c(this.model_type,{id:{type:"_raw"}}),this.beforeSend=t.beforeSend,this.event_emitter=a.extend({},n.Events)}return e.prototype.initialize=function(){return this.is_initialized?void 0:(this.is_initialized=!0,this.schema.initialize())},e.prototype.resetSchema=function(e,t){return this.http("delete",null,{},t)},e.prototype.cursor=function(e){return null==e&&(e={}),new u(e,{model_type:this.model_type,sync:this})},e.prototype.destroy=function(e,t){var r;return 1===arguments.length&&(r=[{},e],e=r[0],t=r[1]),this.http("delete",null,{query:e},t)},e.prototype.http=function(e,t,r,n){var o,u;return o=t?a.result(t,"url"):this.url,r.query&&a.size(r.query)&&(u=l.parse(o,!0),a.extend(u.query,s.toQuery(r.query)),o=l.format(u)),backboneSync(e,t||this.event_emitter,a.extend({url:o,beforeSend:this.beforeSend},r,{success:function(e){return n(null,s.parse(e))},error:function(t){return n(a.extend(new Error("Ajax failed with status "+t.status+" for "+e),{status:t.status}))}}))},e}(),e.exports=function(t,r){var n,o,u;return p.isCollection(new t)?(n=p.configureCollectionModelType(t,e.exports,r),t.prototype.sync=n.prototype.sync):(o=new i(t,r),t.prototype.sync=u=function(t,r,n){var u;if(null==n&&(n={}),o.initialize(),"createSync"===t)return e.exports.apply(null,Array.prototype.slice.call(arguments,1));if("sync"===t)return o;if("schema"===t)return o.schema;if("isRemote"===t)return!0;if(a.contains(["create","update","patch","delete","read"],t)){if(!(u=n.url||a.result(r,"url")))throw new Error("Missing url for model");return"read"===t&&(n=a.extend({$one:!r.models},n)),void o.http(t,r,a.omit(n,"error","success"),function(){return function(e,t){return e?n.error(e):n.success(t)}}(this))}return o[t]?o[t].apply(o,Array.prototype.slice.call(arguments,1)):void 0},p.configureModelType(t),BackboneORM.model_cache.configureSync(t,u))},e.exports.capabilities=function(){return o}},function(e,t,r){var n,o,u,i,s={}.hasOwnProperty,c=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=r(1),u=i._,n=i.Cursor,e.exports=o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.toJSON=function(e){var t;return this.hasCursorQuery("$zero")?e(null,this.hasCursorQuery("$one")?null:[]):this.sync.http("read",null,{query:t=u.extend({},this._find,this._cursor)},function(r){return function(n,o){return t.$one&&n&&404===n.status?e(null,null):e(null,r.hasCursorQuery("$count")||r.hasCursorQuery("$exists")?o.result:o)}}(this))},t}(n)}])});