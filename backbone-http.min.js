/*
  backbone-http.js 0.6.2
  Copyright (c) 2013-2014 Vidigami
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/vidigami/backbone-http
  Dependencies: Backbone.js, Underscore.js, and BackboneORM.
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("backbone-orm")):"function"==typeof define&&define.amd?define(["backbone-orm"],t):"object"==typeof exports?exports.BackboneHTTP=t(require("backbone-orm")):e.BackboneHTTP=t(e.BackboneORM)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,o,u,i,s,c,l,a,p;a=u=r(1),l=a._,n=a.Backbone,e.exports=o=r(2),s={configure:r(4),sync:r(3),_:l,Backbone:n},l.extend(o,s),o.modules={"backbone-orm":u},p=u.modules;for(i in p)c=p[i],o.modules[i]=c},function(t){t.exports=e},function(e){e.exports={}},function(e,t,r){var n,o,u,i,s,c,l,a,p,f,y,d;d=o=r(1),y=d._,n=d.Backbone,p=d.Utils,c=d.JSONUtils,l=d.Schema,a=o.modules.url,f=n.sync,i=r(5),u={embed:"maybe",json:"maybe",unique:"maybe",manual_ids:!1,dynamic:!1,self_reference:"maybe"},s=function(){function e(e,t){if(this.model_type=e,null==t&&(t={}),this.model_type.model_name=p.findOrGenerateModelName(this.model_type),!(this.url=y.result(new this.model_type,"url")))throw new Error("Missing url for model: "+this.model_type);this.schema=new l(this.model_type,{id:{type:"_raw"}}),this.beforeSend=t.beforeSend,this.event_emitter=y.extend({},n.Events)}return e.prototype.initialize=function(){return this.is_initialized?void 0:(this.is_initialized=!0,this.schema.initialize())},e.prototype.resetSchema=function(e,t){return this.http("delete",null,{},t)},e.prototype.cursor=function(e){return null==e&&(e={}),new i(e,{model_type:this.model_type,sync:this})},e.prototype.destroy=function(e,t){var r;return 1===arguments.length&&(r=[{},e],e=r[0],t=r[1]),this.http("delete",null,{query:e},t)},e.prototype.http=function(e,t,r,n){var o,u;return o=t?y.result(t,"url"):this.url,r.query&&y.size(r.query)&&(u=a.parse(o,!0),y.extend(u.query,c.querify(r.query)),o=a.format(u)),f(e,t||this.event_emitter,y.extend({url:o,beforeSend:this.beforeSend},r,{success:function(e){return n(null,c.parse(e))},error:function(t){return n(y.extend(new Error("Ajax failed with status "+t.status+" for "+e),{status:t.status}))}}))},e}(),e.exports=function(t,r){var n,u,i;return p.isCollection(new t)?(n=p.configureCollectionModelType(t,e.exports,r),t.prototype.sync=n.prototype.sync):(u=new s(t,r),t.prototype.sync=i=function(t,r,n){var o;if(null==n&&(n={}),u.initialize(),"createSync"===t)return e.exports.apply(null,Array.prototype.slice.call(arguments,1));if("sync"===t)return u;if("schema"===t)return u.schema;if("isRemote"===t)return!0;if(y.contains(["create","update","patch","delete","read"],t)){if(!(o=n.url||y.result(r,"url")))throw new Error("Missing url for model");return"read"===t&&(n=y.extend({$one:!r.models},n)),void u.http(t,r,y.omit(n,"error","success"),function(){return function(e,t){return e?n.error(e):n.success(t)}}(this))}return u[t]?u[t].apply(u,Array.prototype.slice.call(arguments,1)):void 0},p.configureModelType(t),o.model_cache.configureSync(t,i))},e.exports.capabilities=function(){return u}},function(e,t,r){e.exports=r(1).configure},function(e,t,r){var n,o,u,i,s={}.hasOwnProperty,c=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=r(1),u=i._,n=i.Cursor,e.exports=o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.toJSON=function(e){var t;return this.hasCursorQuery("$zero")?e(null,this.hasCursorQuery("$one")?null:[]):this.sync.http("read",null,{query:t=u.extend({},this._find,this._cursor)},function(r){return function(n,o){return t.$one&&n&&404===n.status?e(null,null):e(null,r.hasCursorQuery("$count")||r.hasCursorQuery("$exists")?o.result:o)}}(this))},t}(n)}])});